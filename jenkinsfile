def deployEnvironments = ['Staging', 'Production'].join('\n')
 pipeline {
    agent any
  
    parameters {
    choice(
        name: 'Environment',
        choices: deployEnvironments,
        description: 'Which environment to test?',
    )
  }
     stages {
        stage('Build') {
             steps {
                 echo 'Building..'
             }
         }
         stage('Clean'){
             steps {
                 echo 'Clean...'
                 bat '''mvn clean'''
             }
         }
         stage('Validate')
         {
             steps{
             bat '''mvn validate'''
             }
         }
         stage('Compile')
         {
             steps{
             bat'''mvn compile'''
             }
         }
         
         stage('Test') {
             steps {
                 echo 'Testing..'
                bat'''mvn test'''
            }
        }
        
    }
    
    post {
 
    aborted {
      slackNotify("Aborted")
    }
    success {
      slackNotify("Success")
    }
    failure {
      slackNotify("Failure")
    }
  }
}
def slackNotify(type, message=null, channels=['backendjenkins']) {
  color = "#8c8c8c"
  if (type == "Success") {
    color = "#36a64f"
  } else if (type == "Failure") {
    color = "#d00000"
  }

  def slackMsg = message;
  if (message == null) {
    slackMsg = "Automation Test Â» ${env.GIT_BRANCH} - #${env.BUILD_NUMBER} ${type} (<${env.BUILD_URL}|Open>)";
  }

  channels.each {
    slackSend(
      color: "${color}", botUser: true, channel: "${it}",
      message: slackMsg
    )
  }
}
